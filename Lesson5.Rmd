---
params:
  lesson: "Lesson 5"
  title: "`if` statements and subsetting data"
  bookchapter_name: "Section 3.5.1"    
  bookchapter_section: "https://r4ds.had.co.nz/data-visualisation.html#facets"
  functions: "`geom_bar`, `list`, `filter`, `subset`, `here`"
  packages: "`here`"      
  # end inputs ---------------------------------------------------------------
header-includes: \usepackage{float}
always_allow_html: yes
output:
  html_document:
    code_folding: show
---
  
```{r, setup, echo = FALSE, cache = FALSE, include = FALSE}
options(width=100)
knitr::opts_chunk$set(
  eval = FALSE, # run all code
  echo = TRUE, # show code chunks in output 
  tidy = TRUE, # make output as tidy
  message = FALSE,  # mask all messages
  warning = FALSE, # mask all warnings 
  comment = "",
  tidy.opts=list(width.cutoff=100), # set width of code chunks in output
  size="small" # set code chunk size
  )

```
\

<!-- install packages -->
```{r, load packages, eval=T, include=T, cache=F, message=F, warning=F, results='hide',echo=F}
packages <- c("ggplot2","ggthemes","dplyr","tidyverse","zoo","RColorBrewer","viridis","plyr")   
if (require(packages)) {
    install.packages(packages,dependencies = T)
    require(packages)
    # load tvthemes
    devtools::install_github("Ryo-N7/tvthemes")
}
lapply(packages,library,character.only=T)  
```

<!-- ____________________________________________________________________________ -->
<!-- ____________________________________________________________________________ -->
<!-- ____________________________________________________________________________ -->
<!-- start body -->

# `r paste0(params$lesson,": ",params$title)`    
\  

Functions for `r params$lesson`  
`r params$functions`    
\    

Packages for `r params$lesson`          
`r params$packages`        
\    

# Agenda

[Data visualisation in `R` for Data Science, `r params$bookchapter_name`](`r params$bookchapter_section`).        
 
<!--  end yaml template------------------------------------------------------- -->
  
* Chop up datasets into smaller parts using `filter` and `subset`  
* Create conditional statements and toggles using `if` and `else`      

# Do First    

Recreate the below plot using the larger NYC Airbnb dataset.    
```{r,echo=F,eval=T,cache=T}
url <- "http://data.insideairbnb.com/united-states/ny/new-york-city/2019-06-02/data/listings.csv.gz"
nyc_full <- read_csv(url) # reads in data
```

```{r, echo=F, eval=T, out.width="100%"}
ttl <- "NYC Airbnb availability"
subttl <- "for room types across neighbourhoods"
xlab <- "Availability of property in next 30 days"
my_theme <- theme_tufte()

# glimpse(nyc_full)  
nyc_full_ <- nyc_full %>% subset(availability_30 > 0)

ggplot() +
  geom_bar(data = nyc_full_, mapping = aes(x = availability_30,
       fill=neighbourhood_group_cleansed), show.legend = FALSE) +
  facet_grid(room_type ~ neighbourhood_group_cleansed) +
  labs(title = ttl,
       subtitle = subttl,
       x = xlab) +
  my_theme 

```


# Reading in data files    
Using `here` to set your working directory  
```{r}
require(here) # load the here package if not already
set_here() # set current working directory 
dr_here() # print current working directory where .here is located
```

1. Create a folder in your directory called **'lookhere'**.  
2. Open a new file in TextEdit (Mac) or Notepad (Windows), type in something like " _We found the here file!_ ", then save the file as **"heretest.txt"**.       
```{r}
list.files() # print files in your current working dir. the 'heretest.txt' file is not here, but one folder below in the new 'lookhere' folder
here("lookhere","heretest.txt") # using here to forage for the file
here("lookhere","heretest.txt") %>% readLines # print the contents in R

```
\  

# Applying the Airbnb data  
Use the new examples on the Airbnb dataset.      

<!-- end body -->
<!-- ____________________________________________________________________________ -->
<!-- ____________________________________________________________________________ -->
<!-- ____________________________________________________________________________ -->


