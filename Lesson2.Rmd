---
params:
  lesson: "Lesson 2"
  title: "Reading data, setting working directories, and plotting facets"
  bookchapter_name: "Section 3.5.1"    
  bookchapter_section: "https://r4ds.had.co.nz/data-visualisation.html#facets"
  functions: "`facet_wrap`, `facet_grid`, `geom_smooth`"
  packages: "No new packages!"      
  # end inputs ---------------------------------------------------------------
header-includes: \usepackage{float}
always_allow_html: yes
output:
  html_document:
    code_folding: hide
---
  
```{r, setup, echo = FALSE, cache = FALSE, include = FALSE}
options(width=100)
knitr::opts_chunk$set(
  eval = FALSE, # run all code
  echo = TRUE, # show code chunks in output 
  tidy = TRUE, # make output as tidy
  message = FALSE,  # mask all messages
  warning = FALSE, # mask all warnings 
  comment = "",
  tidy.opts=list(width.cutoff=100), # set width of code chunks in output
  size="small" # set code chunk size
  )
```
\

<!-- install packages -->
```{r, load packages, eval=T, include=T, cache=F, message=F, warning=F, results='hide',echo=F}
packages <- c("ggplot2","ggthemes","dplyr","tidyverse","zoo","RColorBrewer","viridis","plyr")   
if (require(packages)) {
    install.packages(packages,dependencies = T)
    require(packages)
    # load tvthemes
    devtools::install_github("Ryo-N7/tvthemes")
}
lapply(packages,library,character.only=T)  
```

<!-- ____________________________________________________________________________ -->
<!-- ____________________________________________________________________________ -->
<!-- ____________________________________________________________________________ -->
<!-- start body -->

# `r paste0(params$lesson,": ",params$title)`    
\  

Functions for `r params$lesson`  
`r params$functions`    
\    

Packages for `r params$lesson`          
`r params$packages`        
\    

# Agenda

[Data visualisation in `R` for Data Science, `r params$bookchapter_name`](`r params$bookchapter_section`).    

<!--  end yaml template------------------------------------------------------- -->

* Do first problem set
* Read in data file  
* Set working directory `here`  
* Facets  


\  

# Do First problem set  

Before each new session, we'll do a quick recap, called a Do First. These will only use functions we've previously covered, so if you're unsure or can't remember, just check the code from the previous session.    
\    

Recreate the below plot using the smaller NYC Airbnb dataset (`nyc` from Lesson 1). There are four aesthetics to change and the plot uses `theme_solarized`.  
_Hint_: Use the help `?` function if something isn't clear.  
```{r, echo=T}


# You didn't think we'd make it this easy, did you?


```


```{r, echo=F, eval=T, out.width="100%"}
require(ggplot2)
require(dplyr)
require(ggthemes)

# smaller csv file (16 cols)
url <- "http://data.insideairbnb.com/united-states/ny/new-york-city/2019-06-02/visualisations/listings.csv"

nyc <-  read_csv(url)
nyc <- nyc[nyc$id < 1000000,] # get smaller subet of data

ggplot(data=nyc) +
  geom_point(mapping = aes(x=minimum_nights, y=number_of_reviews), colour = "orange", shape = 15, size = 2, alpha = 0.4) +
  theme_solarized()
```
\    

# Some useful shortkeys for making `R` life easier    

`TAB` = autofill rest of function/global variable  
`CTRL + ENTER` = run code    
`ALT (OPTION) + -` = insert assign operator `<-`    
`CTRL + SHIFT + M` = insert pipe `%>%`     
**Run `ALT + SHIFT + K`  for [all available shortkeys](https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts)**        
\        

# Read in data      
```{r}
my_file <- "your_csv_file.csv"
my_data <- read_csv(my_file)
```
\  

# Grouping data    
One way to group your data is by colour  
```{r, eval = T}
my_data <- mpg
my_theme <- theme_classic()
ggplot(data = my_data) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class)) +
  my_theme
```
\  

# Plotting facets    
`facet_wrap` and `facet_grid`  
Facets add a third variable to a plot  
The facet function takes a formula as an argument, which is just a data structure, denoted by a tilde **~**    

`facet_wrap`  
When you have one variable to plot as a facet       
```{r,eval=T}
ggplot(data = my_data) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2) +
  my_theme
```

`facet_grid`  
When you know the two variables you want to plot  
**The formula structure for `facet_grid` is Y variable `~` X variable, e.g. `drv ~ cyl`**           
```{r, eval=T}
ggplot(data = my_data) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_grid(drv ~ cyl) +
  my_theme
```


# Exercise 3.5  
[3.5.1](https://r4ds.had.co.nz/data-visualisation.html#exercises-2)  
  
# Group vs. colour
Using `group` separates the data into objects, but `colour` will distinguish the differences among these objects     
```{r,eval=T}
ggplot(data = my_data) +
  geom_smooth(mapping = aes(x = displ, y = hwy)) +
  my_theme
              
ggplot(data = my_data) +
  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv)) +
  my_theme
    
ggplot(data = my_data) +
  geom_smooth(
    mapping = aes(x = displ, y = hwy, color = drv),
    show.legend = FALSE
  ) +
  my_theme
```

# Geometric objects            

# Adding `geoms`    
Possibly the most useful part of plotting data is layering plot types       
```{r,eval=T}
ggplot(data = my_data) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  geom_smooth(mapping = aes(x = displ, y = hwy)) +
  my_theme
```

# Applying the Airbnb data  
Try using the new examples on the Airbnb dataset.      

<!-- end body -->
<!-- ____________________________________________________________________________ -->
<!-- ____________________________________________________________________________ -->
<!-- ____________________________________________________________________________ -->
